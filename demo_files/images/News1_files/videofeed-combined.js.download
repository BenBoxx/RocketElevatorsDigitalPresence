(function(){var subdomain="www";var last_elapsed=0;var dvRunningTime;var playing=true;var fpLoaded=false;var cfLoaded=false;function hookScriptLoad(script,func){if(script.readyState){script.onreadystatechange=function(){if(script.readyState=='loaded'){func();}}}else{script.onload=func;}}
function vastAd(id,vast_url,el,data){function set_time(player,time){player.emit(flowplayer.events.TIME_UPDATE,time)
player.ads&&player.ads.setCurrentTime(time)}
var ads=function(){return[{"time":0,"adTag":vast_url,"outstream":false}];};function render_ad_player(flowplayer_el){var player=window.player=flowplayer(flowplayer_el,{poster:"//www.dianomi.com/img/uploads/XQDRWVQI7HeQu0hRjKK@qQAAAAI.png",title:"Dianomi / Ad",autoplay:true,token:"eyJraWQiOiJRalBFNnFzeml4QVoiLCJ0eXAiOiJKV1QiLCJhbGciOiJFUzI1NiJ9.eyJjIjoie1wiYWNsXCI6NixcImlkXCI6XCJRalBFNnFzeml4QVpcIn0iLCJpc3MiOiJGbG93cGxheWVyIn0.fzyS2_0rxGN8Nf-XAUc3CV0sUOskGOM4XR0r2o6zUlMjbSCt1txWXK1o1GkjkfxL2dtPJiUsF4JIqSoQEs5Lcg",ima:{ads:ads()}})
player.on(flowplayer.AdEvents.AD_BREAK_COMPLETED,e=>{player.setSrc([])
player.setOpts({autoplay:false})
player.root.addClass(flowplayer.states.STARTING)
player.root.addClass(flowplayer.states.TOUCHED)
player.ads.nextIndex=0
player.ads.setSchedule(ads())})
player.on(flowplayer.events.WAITING,e=>{setTimeout(function(){player.root.removeClass(flowplayer.states.WAITING)},0)})
player.one(flowplayer.AdEvents.AD_BREAK_COMPLETED,e=>{player.on("click",function(){set_time(player,0)})})
player.on(flowplayer.AdEvents.AD_PROGRESS,function(e){var elapsed=e.data.duration-e.data.remaining;var diff=elapsed-last_elapsed;if(diff>1){var xhr=new XMLHttpRequest();xhr.open('GET',"//"+data.site+"/cgi-bin/smartads_video_a.pl?p="+data.unique_id+"&t="+elapsed,true);xhr.send();last_elapsed=elapsed;}});player.on(flowplayer.AdEvents.AD_COMPLETED,function(e){running=clearInterval(running);var xhr=new XMLHttpRequest();xhr.open('GET',"//"+data.site+"/cgi-bin/smartads_video_a.pl?e="+data.unique_id,true);xhr.send();});player.on(flowplayer.AdEvents.AD_PLAYBACK_ERROR,function(e){console.info(e.error.type)});set_time(player,0)}
if("google"in window){header=make_header(data);footer=make_footer(data);el.appendChild(header);var video_el=document.createElement("div");el.appendChild(video_el);el.appendChild(footer);render_ad_player(video_el);}}
function videoAd(id,el,data){if(data.hasOwnProperty("vast_url")&&data.vast_url!==null){vast_init(id,data.vast_url,el,data,function(){vastAd(id,data.vast_url,el,data);});}else if(data.hasOwnProperty("cloudflare_stream_id")){cloudflare_realAd(id,el,data);}}
function videoElement(el){var done=el.getAttribute("data-dianomi-video-done");if(done&&done==="1"){return;}
var id=el.getAttribute("data-dianomi-video-id");var name=el.getAttribute("data-dianomi-cf-name");var sd=el.getAttribute("data-dianomi-video-subdomain");if(sd){subdomain=sd;}
var xmlHttpRequest=new XMLHttpRequest();var url="//"+subdomain+".dianomi.com/cgi-bin/smartads_video_json.pl?id="+id;if(name){url+="&cf="+name;}
xmlHttpRequest.open("GET",url,true);xmlHttpRequest.withCredentials=true;xmlHttpRequest.onreadystatechange=function(){if(xmlHttpRequest.readyState!=4||xmlHttpRequest.status!=200)return;videoAd(id,el,JSON.parse(xmlHttpRequest.responseText));};el.setAttribute("data-dianomi-video-done","1");xmlHttpRequest.send();}
function init(){var videoElements=document.querySelectorAll(".dianomi_video");for(var i=0;i<videoElements.length;i++){videoElement(videoElements[i]);}}
function vast_init(id,url,el,data,callback){if(fpLoaded){return callback();}
var stylesheet=document.createElement("link");stylesheet.rel='stylesheet';stylesheet.href='//cdn.flowplayer.com/releases/native/stable/style/flowplayer.css';document.head.appendChild(stylesheet);addCss('//'+data.site+'/partner/dianomi/css/dianomi-video.css?v=2.19b');var flowPlayerLoaded=false;var pluginsLoaded=false;var imaLoaded=false;function allLoaded(){return flowPlayerLoaded&&pluginsLoaded&&imaLoaded;}
var flowPlayerScript=document.createElement("script");flowPlayerScript.type="text/javascript";flowPlayerScript.defer=true;flowPlayerScript.src="//cdn.flowplayer.com/releases/native/stable/flowplayer.min.js";hookScriptLoad(flowPlayerScript,function(){flowPlayerLoaded=true;if(allLoaded()){fpLoaded=true;callback();}});document.head.appendChild(flowPlayerScript);var pluginScript=document.createElement("script");pluginScript.type="text/javascript";pluginScript.defer=true;pluginScript.src="//cdn.flowplayer.com/releases/native/stable/plugins/ads.min.js";hookScriptLoad(pluginScript,function(){pluginsLoaded=true;if(allLoaded()){fpLoaded=true;callback();}})
document.head.appendChild(pluginScript);var imaScript=document.createElement("script");imaScript.type="text/javascript";imaScript.defer=true;imaScript.src="//imasdk.googleapis.com/js/sdkloader/ima3.js";hookScriptLoad(imaScript,function(){imaLoaded=true;if(allLoaded()){fpLoaded=true;callback();}})
document.head.appendChild(imaScript);}
function fireStart(data){if(data.start_video_tracker){var img=document.createElement("img");img.setAttribute("src",data.start_video_tracker);img.setAttribute("style","display:none");document.body.appendChild(img);}}
function addCss(fileName){var head=document.head;var link=document.createElement("link");link.type="text/css";link.rel="stylesheet";link.href=fileName;head.appendChild(link);}
function isInViewport(elem){if(elem){var dianomiVideo=elem.getBoundingClientRect();var width=window.innerWidth||document.documentElement.clientWidth;var height=window.innerHeight||document.documentElement.clientHeight;var left=Math.max(0,dianomiVideo.left);var right=Math.min(width,dianomiVideo.right);var bottom=Math.max(-height,-dianomiVideo.bottom);var top=Math.min(0,-dianomiVideo.top);var intersection=((left<right)&&(bottom<top));var area=intersection?(right-left)*(top-bottom):0;var video_area=(dianomiVideo.right-dianomiVideo.left)*(dianomiVideo.bottom-dianomiVideo.top);var percentage=area/video_area*100;return percentage>50;}
return false;}
function cloudflare_getStream(id){var elementId="dianomi-video_"+id;return document.getElementById(elementId);}
function onPause(){dvRunningTime=clearInterval(dvRunningTime);}
function toggleMute(video_id,video_el){var unmute=video_el.querySelectorAll(".unmute")[0];var mute=video_el.querySelectorAll(".mute")[0];var dianomiStream=cloudflare_getStream(video_id);if(dianomiStream.muted){dianomiStream.muted=false;unmute.style.display="block";mute.style.display="none";}else{dianomiStream.muted=true;mute.style.display="block";unmute.style.display="none";}}
function togglePlayP(video_id,video_el){var videoElement=cloudflare_getStream(video_id);var PauseBtn=video_el.querySelectorAll(".pause")[0];var PlayBtn=video_el.querySelectorAll(".play")[0];if(playing===false){videoElement.play();playing=true;PlayBtn.style.display="none";PauseBtn.style.display="block";}else{videoElement.pause();playing=false;PauseBtn.style.display="none";PlayBtn.style.display="block";}}
function onPlaying(video_id,data){if(dvRunningTime){clearInterval(dvRunningTime);}
dvRunningTime=setInterval(function(){var dianomiVideo=cloudflare_getStream(video_id);var play_time=dianomiVideo.currentTime;var xhr=new XMLHttpRequest();xhr.open('GET',"//"+data.site+"/cgi-bin/smartads_video_a.pl?p="+data.unique_id+"&t="+play_time,true);xhr.send();},2000);}
function DVonLoad(video_el,video_id,data){function tabChange(event){var dianomiStream=cloudflare_getStream(video_id);var inV=isInViewport(dianomiStream);window.onblur=function(){var dianomiStream=cloudflare_getStream(video_id);if(dianomiStream){dianomiStream.pause();dvRunningTime=clearInterval(dvRunningTime);}};window.onfocus=function(){var dianomiStream=cloudflare_getStream(video_id);if(inV&&dianomiStream.paused){dianomiStream.play();}};}
video_el.querySelectorAll(".play")[0].addEventListener("click",function(){togglePlayP(video_id,video_el);},false);video_el.querySelectorAll(".pause")[0].addEventListener("click",function(){togglePlayP(video_id,video_el);},false);video_el.querySelectorAll(".mute")[0].addEventListener("click",function(){toggleMute(video_id,video_el);},false);video_el.querySelectorAll(".unmute")[0].addEventListener("click",function(){toggleMute(video_id,video_el);},false);document.addEventListener("visibilitychange",tabChange);window.addEventListener('scroll',function(event){var v=cloudflare_getStream(video_id);if(v){var inV=isInViewport(v);if(inV&&v.paused){v.play();if(dvRunningTime){clearInterval(dvRunningTime);}
dvRunningTime=setInterval(function(){var play_time=v.currentTime;var xhr=new XMLHttpRequest();xhr.open('GET',"//"+data.site+"/cgi-bin/smartads_video_a.pl?p="+data.unique_id+"&t="+play_time,true);xhr.send();},5000);var xhr=new XMLHttpRequest();xhr.open('GET',"//"+data.site+"/cgi-bin/smartads_video_a.pl?s="+data.unique_id,true);xhr.send();fireStart(data);}else if(!inV&&!v.paused){v.pause();}}});}
function onEnd(data){dvRunningTime=clearInterval(dvRunningTime);var xhr=new XMLHttpRequest();xhr.open('GET',"//"+data.site+"/cgi-bin/smartads_video_a.pl?e="+data.unique_id,true);xhr.send();}
function setListeners(video_id,data){var dianomiStream=cloudflare_getStream(video_id);if(dianomiStream){dianomiStream.addEventListener('play',function(){onPlaying(video_id,data);});dianomiStream.addEventListener('ended',function(){onEnd(data);});dianomiStream.addEventListener('pause',onPause);}}
function cloudflare_realAd(video_id,video_el,data){var dianomiStream=document.createElement('stream');dianomiStream.id='dianomi-video_'+video_id;dianomiStream.className='dianomi-video';dianomiStream.setAttribute('src',data.cloudflare_stream_id);dianomiStream.setAttribute('mute','mute');dianomiStream.setAttribute("width","100%");dianomiStream.setAttribute("preload","preload");dianomiStream.muted=true;video_el.appendChild(dianomiStream);cloudflare_init(video_id,video_el,data,function(){cloudflare_videoInit(video_id,data,video_el);});}
function cloudflare_videoInit(video_id,data,video_el){var ClsBtn=document.createElement('button');ClsBtn.setAttribute('class','openclose');ClsBtn.innerHTML='&times;';ClsBtn.id="openclose_"+video_id;var UMuBtn=document.createElement('button');UMuBtn.setAttribute('class','unmute');UMuBtn.setAttribute('style','display:none;');UMuBtn.innerHTML='<img src="//'+data.site+'/img/icons/Speaker_Icon.svg" width=20 height=20/>';UMuBtn.id="unmute_"+video_id;var MuBtn=document.createElement('button');MuBtn.setAttribute('class','mute');MuBtn.innerHTML='<img src="//'+data.site+'/img/icons/Mute_Icon.svg" width=20 height=20/>';MuBtn.id="mute_"+video_id;var PlayBtn=document.createElement('button');PlayBtn.setAttribute('class','playpause play');PlayBtn.setAttribute('style','position: absolute: left: 0; display: none;');PlayBtn.innerHTML='&#9658;';PlayBtn.id="PlayBtn_"+video_id;var PauseBtn=document.createElement('button');PauseBtn.setAttribute('class','playpause pause');PauseBtn.setAttribute('style','position: absolute: left: 0;');PauseBtn.innerHTML='&#10073;&#10073;';PauseBtn.id="PauseBtn_"+video_id;video_el.appendChild(ClsBtn);video_el.appendChild(UMuBtn);video_el.appendChild(MuBtn);video_el.appendChild(PlayBtn);video_el.appendChild(PauseBtn);video_el.style.maxHeight="600px";video_el.classList.add("dianomiVideoWrapper");var exit=false;ClsBtn.addEventListener("click",function(e){if(exit==false){e.preventDefault();video_el.style.maxHeight="0px";video_el.style.padding="0px";setTimeout(function(){video_el.remove();},800);if(dvRunningTime){clearInterval(dvRunningTime);}
return false;}});video_el.addEventListener("click",function(e){var tagName=e.target.tagName;if(tagName!=='VIDEO'){return;}else{window.open(data.link);}});DVonLoad(video_el,video_id,data);setListeners(video_id,data);var dianomiStream=cloudflare_getStream(video_id);var inV=isInViewport(dianomiStream);if(inV&&dianomiStream){dianomiStream.play();var xhr=new XMLHttpRequest();xhr.open('GET',"//"+data.site+"/cgi-bin/smartads_video_a.pl?s="+data.unique_id,true);xhr.send();fireStart(data);}}
function make_header(data){var clientImageTag=(data.advertiser_image)?'<img style="padding: 5px;" height=30 src='+data.advertiser_image+'>':'';var clientText='<div class="dianomi-header-text" height="50"><span>Sponsored Video by &nbsp;'+clientImageTag+'</div>';var mainText='<div class="dianomi-main-text"><a href="'+data.link+'" target="_blank">'+data.advertiser_text+'</a></div>';var ctaText='<div class="dianomi-cta-text"><a href="'+data.link+'" target="_blank">'+data.advertiser_call_to_action+'</a></div>';var poweredBy='<div style="float:right">Video Ad by <img src="//'+data.site+'/img/dianomi-max-200x38.png" width=50 height=10/></div>';var header=document.createElement('div');header.className="dianomi-text-wrapper";header.innerHTML+=clientText;header.innerHTML+=mainText;header.innerHTML+=ctaText;return header;}
function make_footer(data){var poweredBy='<div style="float:right">Video Ad by <img src="//'+data.site+'/img/dianomi-max-200x38.png" width=50 height=10/></div>';var footer=document.createElement('div');footer.className="sub-line2";footer.innerHTML+=poweredBy;return footer;}
function cloudflare_init(id,video_el,data,callback){header=make_header(data);footer=make_footer(data);video_el.insertBefore(header,video_el.firstChild);video_el.appendChild(footer);if(cfLoaded){return callback();}
var script=document.createElement('script');script.type='text/javascript';script.defer=true;script.src='https://embed.videodelivery.net/embed/r4xu.fla9.latest.js?video='+data.cloudflare_stream_id;hookScriptLoad(script,function(){cfLoaded=true;callback();});var head=document.getElementsByTagName('head')[0];head.appendChild(script);addCss('//'+data.site+'/partner/dianomi/css/dianomi-video.css?v=2.19b');}
init();}())