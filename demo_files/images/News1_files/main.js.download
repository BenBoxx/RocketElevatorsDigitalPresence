// Safari 3.0+ "[object HTMLElementConstructor]"
var titleBG = document.getElementById("titlebg");
var ua = navigator.userAgent.toLowerCase();
var frm1 = document.getElementById("frm1");
var aIName;

var Ad = {
    init: function () {


        TweenMax.set([container, logo, titlebg], {opacity: 0});
        //shorten myFT.instantAds ref
        instAds = myFT.instantAds;

        /*logo.src = instAds.Logo1;
        bg.src = instAds.Image;*/
        var allImgs = [
            {ia: instAds.Logo1, id: 'logo'},
            {ia: instAds.Title_image, id: 'titlebg'}
        ];


        container.style.background = instAds.Overlay_color;
        headline1.innerHTML = instAds.Headline1 + "&nbsp;<span id='sub_headline'>" + instAds.Sub_headline + "</span>";
        // sub_headline.innerHTML = instAds.Sub_headline;
        logo2.src = instAds.Logo2;
        cta.innerHTML = instAds.CTA_Copy;
        cta.style.color = instAds.CTA_Color;
        cta.style.background = instAds.CTA_BG_Color;

        //load images
        Ad.loadImgs(allImgs);

    },
    /*******************  HELPER FUNCTIONS  ***********************/

    //LOAD IMAGES
    loadImgs: function (allImgs, returnFunc) {
        var tmpCnt = 0;
        for (var i = 0; i < allImgs.length; i++) {
            var elm = document.getElementById(allImgs[i].id);
            elm.onerror = function (e) {
                Ad.lg('IMAGE LOAD ERROR :: ' + e.id);
                e.src = "images/blank.png";
            };
            elm.onload = function (e) {
                tmpCnt++;
                if (tmpCnt === allImgs.length) {
                    //     Ad.lg('HERO/PRODUCT IMAGES HAVE LOADED');
                    Ad.addListeners();
                }
            };
            elm.src = allImgs[i].ia;
        }
    },//ADD LISTENERS
    addListeners: function () {
        myFT.applyClickTag(btn, 1, myFT.instantAds.ClickThrough_URL);
        // myFT.applyClickTag(btn,1,myFT.instantAds.clickTag_url);
        Ad.goBanner();
    },
    goBanner: function () {
        // var subHead_Y = -140;
        var titleH = titlebg.clientHeight;
        var headline1H = headline1.clientHeight;

        // var subHeadH = sub_headline.clientHeight;

        var ctaH = cta.clientHeight;
        if (headline1H <= 35) {
            headline_Y = -(headline1H + 29);
        } else {
            headline_Y = -(headline1H + 20);
        }

        var logo2H = logo2.clientHeight;
        // var topPos = 89 - (titleH - headline_Y);
        var topPos = 72 - (titleH - headline_Y);
        // Frame 1

        var sourceImage = document.createElement('img');
        sourceImage.src = instAds.Title_image;
        titlescrolling.appendChild(sourceImage);
        for (i = 0; i < 11; i++) {
            titlescrolling.appendChild(sourceImage.cloneNode(true));
        }

        var movescrollTopPerc;
        titleHperc = (titleH / 90) * 100;

        var titlescrollHPerc = titleHperc * 7;
        // movescrollTopPerc = -(titlescrollHPerc+220);//+37
        console.log(titleH);

        if (titleH <= 20) {
            if (ua.indexOf('safari') != -1) {
                if (ua.indexOf('chrome') > -1) {
                    movescrollTopPerc = -(titlescrollHPerc + 100);
                } else {
                    movescrollTopPerc = -(titlescrollHPerc + 100);
                }
            } else {
                movescrollTopPerc = -(titlescrollHPerc + 100);
            }
        }
        else if (titleH >= 30) {
            movescrollTopPerc = -(titlescrollHPerc + 197);
        }
        else if (titleH >= 21) {
            if (ua.indexOf('safari') != -1) {
                if (ua.indexOf('chrome') > -1) {
                  // movescrollTopPerc = -(titlescrollHPerc + 137);
                    // movescrollTopPerc = -(titlescrollHPerc + 10);
                    movescrollTopPerc = -307;
                } else {
                    // movescrollTopPerc = -(titlescrollHPerc + 10);
                    movescrollTopPerc = -307;

                }
            } else {
                // movescrollTopPerc = -(titlescrollHPerc + 10);
                movescrollTopPerc = -307;

            }
        }


        TweenMax.to([borderBox, container], .35, {opacity: 1});
        // FRAME 1
        TweenMax.to(logo2, 0.3, {alpha: 1, ease: Sine.easeInOut, delay: 0});

        // FRAME 1
        // Internet Explorer 6-11
        var isIE = /*@cc_on!@*/false || !!document.documentMode;

        // Edge 20+
        var isEdge = !isIE && !!window.StyleMedia;
        // var ie_scale = .65;
        var ie_scale = .83;
        var chrome_scale = .83;
        var left_prop = 117;
        // var frm1_timing = 2.15;
        var frm1_timing = 1.935;
        // var titlescroll_timing = 2.5 * 0.9;
        var titlescroll_timing = 2.25; // ( 10% faster than the original )

        if (titleH <= 29) {
            if (isIE || isEdge) {
                TweenMax.to(frm1, frm1_timing, {
                    left: left_prop,
                    top: 14,
                    scale: ie_scale,
                    y: topPos,
                    force3D: true,
                    z: 0.01,
                    rotationZ: 0.01,
                    ease: Sine.easeInOut,
                    delay: 1.5
                });
                TweenMax.to(titlescrolling, titlescroll_timing, {
                    top: (movescrollTopPerc) + "%",
                    force3D: true,
                    z: 0.01,
                    rotationZ: 0.01,
                    ease: Sine.easeIn,
                    delay: 1
                });
            }
            else {

                if (ua.indexOf('safari') != -1) {
                    if (ua.indexOf('chrome') > -1) {
                        /*TweenMax.to(frm1, frm1_timing,{left: 117, scale:.65, y: topPos, force3D:false, rotationZ: 0.01, ease:  Sine.easeInOut,delay:1.5});
                        TweenMax.to(titlescrolling,titlescroll_timing,{top: (movescrollTopPerc)+"%", force3D:false, rotationZ: 0.01, ease:  Sine.easeIn ,delay:1});*/
                    } else {
                        TweenMax.to(frm1, frm1_timing, {
                            left: left_prop,
                            top: 14,
                            scale: chrome_scale,
                            y: topPos,
                            force3D: false,
                            z: 0.01,
                            rotationZ: 0.01,
                            ease: Sine.easeInOut,
                            delay: 1.5
                        });
                        TweenMax.to(titlescrolling, titlescroll_timing, {
                            top: (movescrollTopPerc) + "%",
                            force3D: false,
                            z: 0.01,
                            rotationZ: 0.01,
                            ease: Sine.easeIn,
                            delay: 1
                        });
                    }
                }
                TweenMax.to(frm1, frm1_timing, {
                    left: left_prop,
                    top: 14,
                    scale: chrome_scale,
                    y: topPos,
                    force3D: false,
                    rotationZ: 0.01,
                    ease: Sine.easeInOut,
                    delay: 1.5
                });
                TweenMax.to(titlescrolling, titlescroll_timing, {
                    top: (movescrollTopPerc) + "%",
                    force3D: false,
                    rotationZ: 0.01,
                    ease: Sine.easeInOut,
                    delay: 1
                });
            }
        }
        else if (titleH >= 30) {
            if (isIE || isEdge) {
                TweenMax.to(frm1, frm1_timing, {
                    left: 12,
                    scale: .35,
                    y: topPos,
                    force3D: true,
                    z: 0.01,
                    rotationZ: 0.01,
                    ease: Sine.easeInOut,
                    delay: 1.5
                });
                TweenMax.to(titlescrolling, titlescroll_timing, {
                    top: (movescrollTopPerc) + "%",
                    force3D: true,
                    z: 0.01,
                    rotationZ: 0.01,
                    ease: Sine.easeIn,
                    delay: 1
                });
            } else {
                if (ua.indexOf('safari') != -1) {
                    if (ua.indexOf('chrome') > -1) {
                        /*
                       TweenMax.to(frm1, frm1_timing,{left: 12, scale:.35, y: topPos, force3D:false, rotationZ: 0.01, ease:  Sine.easeInOut,delay:1.5});
                       TweenMax.to(titlescrolling,titlescroll_timing,{top: (movescrollTopPerc)+"%", force3D:false, rotationZ: 0.01, ease:  Sine.easeIn ,delay:1});*/
                    } else {
                        TweenMax.to(frm1, frm1_timing, {
                            left: 12,
                            scale: .35,
                            y: topPos,
                            force3D: false,
                            z: 0.01,
                            rotationZ: 0.01,
                            ease: Sine.easeInOut,
                            delay: 1.5
                        });
                        TweenMax.to(titlescrolling, titlescroll_timing, {
                            top: (movescrollTopPerc) + "%",
                            force3D: false,
                            z: 0.01,
                            rotationZ: 0.01,
                            ease: Sine.easeIn,
                            delay: 1
                        });
                    }
                }
                TweenMax.to(frm1, frm1_timing, {
                    left: -18,
                    top:25,
                    scale: .45,
                    y: topPos,
                    force3D: false,
                    rotationZ: 0.01,
                    ease: Sine.easeInOut,
                    delay: 1.5
                });
                TweenMax.to(titlescrolling, titlescroll_timing, {
                    top: (movescrollTopPerc) + "%",
                    force3D: false,
                    rotationZ: 0.01,
                    ease: Sine.easeInOut,
                    delay: 1
                });
            }
        }
        /*else if(titleH >= 21){
        }*/

        // FRAME 2
        TweenMax.set(logo, {left: -728});
        TweenMax.to(logo, 1, {left: 0, opacity: 1, delay: 2.8});
        TweenMax.to(frm2, 0.5, {opacity: 1, ease: Power2.easeOut, delay: 3.25}); // +0.45
        TweenMax.to(headline1, 0.75, {y: (headline_Y), ease: Power2.easeOut, delay: 3.25}); // +0.45
        TweenMax.to(cta, 1, {y: -90, opacity: 1, ease: Power2.easeOut, delay: 3.0}); // +0.2
    }
}

myFT.on("instantads", function () {
    //Quick Fix for this images only
    function findImageName(name) {
        aIName = myFT.instantAds.Title_image.toLowerCase();
        return aIName.search(name);
    }
    //
    // //-------  BizPack
    // if (findImageName("bizpak") > 0) {
    //     frm1.style.left = "0.1%";
    //     frm1.style.transform = "scale(1)";
    //
    // }
    //
    // // -------  Carnail_Pass_728x90_v_2.png
    // if (findImageName("carnail") > 0) {
    //     frm1.style.left = "29.5%";
    //     frm1.style.transform = "scale(1.6)";
    //
    // }
    // // ------  Commuter_E-Pass_728x90_v_2.png
    // if (findImageName("commuter") > 0) {
    //     frm1.style.transform = "scale(1.4)";
    //     frm1.style.left = "19.6%";
    // }
    //
    // // //------ Discount_Tuesdays_v_2.png
    // if (findImageName("tuesdays") > 0) {
    //     frm1.style.transform = "scale(1.6)";
    //     frm1.style.left = "29.5%";
    //
    // }
    // //------ Graphic_Carte_Banlieue_728x90_v_2.png
    // if (findImageName("carte") > 0) {
    //     frm1.style.transform = "scale(1.6)";
    //     frm1.style.left = "29.5%";
    //
    // }
    //
    // //-----  Mardis_A_Rabais_728x90_v_2.png
    // if (findImageName("rabais") > 0) {
    //     frm1.style.transform = "scale(1.1)";
    //     frm1.style.left = "5.1%";
    //     frm1.style.height = "97%";
    //
    // }
    // //------ Via6Pak_728x90_v_2.png
    // if (findImageName("via6pak") > 0) {
    //     frm1.style.transform = "scale(1)";
    //     frm1.style.left = "0%";
    //     frm1.style.height = "97%";
    //     frm1.style.width = "97%";
    // }
    //this must fire before referencing IA vars
    Ad.init();
});
